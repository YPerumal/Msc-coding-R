---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---


```{r}
# library imports
library(tidyverse)
```

### Import Data
```{r}
df <- read.csv('/Volumes/GoogleDrive/My Drive/Yevashan Perumal MSc v2/Data/data with some cdw.csv')
```

```{r}
head(df)
```

```{r}
dim(df)
```


Drop the unnecessary columns
```{r}
cols_to_drop <- c('RecordID','ProductCode','DimGCSPartyKeyLifeCovered'
                  ,'DimDateKeyInitiated','DimDateKeyFinalised','DimDateKeyAccepted'
                  ,'UnderwritingInitiationDate','UnderwritingFinaliseDate')

#drop columns
df2 <- df %>% select(-all_of(cols_to_drop))

#remove duplicate rows
df2 <- df2 %>% distinct()

dim(df2)
```
```{r}
head(df2)
```
```{r}
str(df2)
```
<<<<<<< HEAD


```{r}
# Unique values for all variables in the dataframe

# tab1 <- df2 %>% summarise_all(n_distinct)%>%t()
# tab1 <- data.frame(tab1)
# tab1 %>% arrange(tab1)
```
# Univariate exploration

## Numeric Variables (and ones that should be)

###### UnderwritingDuration
```{r}
summary(df2$UnderwritingDuration)
df2 %>% ggplot(aes(x=UnderwritingDuration))+geom_histogram()
#all
df2 %>% ggplot(aes(x=UnderwritingDuration))+geom_boxplot()
# remove some outliers eyeballing the boxplot
df2 %>% filter(UnderwritingDuration<100) %>% ggplot(aes(x=UnderwritingDuration))+geom_boxplot()

#unique vals
length(unique(df2$UnderwritingDuration))
```
Seems like a reasonable amount of info. Some definite weird outliers that would need to be treated.
Think it's how long the underwriting process took in days

```{r}
numeric_explorer <- function(data,variable,filter_hist){
                
                # summary(data$variable)
                data %>% ggplot(aes(x=variable))+geom_histogram()
                #all
                data %>% ggplot(aes(x=variable))+geom_boxplot()
                # remove some outliers eyeballing the boxplot
                # data %>% filter(variable<filter_hist) %>% ggplot(aes(x=variable))+geom_boxplot()
}

numeric_explorer(df2,UnderwritingDuration,100)

box_and_hist <- function(variable){
    hist <- df2%>%ggplot(aes_string(x=variable))+geom_histogram()+
            theme(axis.title.x=element_blank(),
                  axis.title.y = element_text(size = 6),
                  plot.title = element_text(size = 8))+
            labs(title = paste("Histogram and Boxplot of",variable))
    boxp <- df2%>%ggplot()+
      geom_boxplot(aes_string(x=variable))+
      theme(axis.title.x = element_text(size =8))
    grid.arrange(hist,boxp,nrow=2)
}
library(gridExtra)
box_and_hist('UnderwritingDuration')
```


###### CurrentCoverAmount
```{r}
# initially showing up as a characater
summary(df2$CurrentCoverAmount)
#unique vals
length(unique(df2$CurrentCoverAmount))

# Investigating the null that happers in the conversion
# df2[df2$CurrentCoverAmount=='NULL',]
# df2$CurrentCoverAmount_converted <- as.numeric(df2$CurrentCoverAmount)
# df2$CurrentCoverAmount_converted <- as.numeric(df2$CurrentCoverAmount)
# df2 %>% select(CurrentCoverAmount_converted,CurrentCoverAmount) %>% filter(is.na(CurrentCoverAmount_converted))

df2$CurrentCoverAmount <- as.numeric(df2$CurrentCoverAmount)


options(scipen = 999)
df2 %>% ggplot(aes(x=CurrentCoverAmount))+geom_histogram()
#all
df2 %>% ggplot(aes(x=CurrentCoverAmount))+geom_boxplot()

# remove some outliers eyeballing the boxplot
df2 %>% filter(CurrentCoverAmount<10**6) %>% ggplot(aes(x=CurrentCoverAmount))+geom_boxplot()

#unique vals
length(unique(df2$UnderwritingDuration))
```
Looks like there is one 'NULL' value that introduces an NA whwen converting to numeric.

# Target Variable
```{r}
df2$GammaGTValue <-  as.integer(df2$GammaGTValue)
df2 %>% filter(GammaGTValue<200) %>%  ggplot(aes(x=GammaGTValue))+geom_histogram(binwidth = 10)
```
Some really weird large outliers than need to be taken care of.
Also some NAs introduced when converting to character.

